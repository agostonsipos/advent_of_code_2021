let algo1 = "..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..###..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###.######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#..#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#......#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#.....####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.......##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#"
let data1 = [|"#..#.";"#....";"##..#";"..#..";"..###"|]

let algo = "##.##.#.####.#.###.#...##.#..####.##.##..###.####.###.#...###..##.####.##.#..#........####..###....#.#..###.##.######..#####.#.##...#.#.#.####.#.##.#.#.#.#.#....#.###.##...##.####.#.#...#..#.##...##.##....##...##...######.####.#.....####..#.#..#..###..####..###...#.##..#.....###..#.##..#....#.#.#..#.####..#..##...#.##.#......#.###..##...#...##.##...#.##...##.....####.#...........#.#.#..####...###...#.....#.#.#.....###.....###.#.#..##..#.##...####.##..#..#...#.##..#######.#.###..#..##...#.###.#.###.##.##.#.."
let data = [|"..#..##..#..#.####..##..#..######.####......#...#..#.##..#..###...#...#..##....#.##.......#######..#";".#.#..####...###.#..##.####..##.##.##.#######.#.#.....##.#..#..#.####.##...#.#..#....##.####.#...#..";"...#........####..#.##..##...#......##.###.##.###....####.#.....#.....#..#.#...##.#.#.#..##..##..##.";".#.#.####..#..##....##.##.#.#####.###.##.###....##....#.#.#.#...##.#..#...#....###...#.##.#........#";"###...#.##.#..###...#..####...#..###..#...###...###..#...##....#.#..#...#..#..##..#..#.######...#.#.";"##..#.#.###.#..#..#.....#####.#.......#.##.##...#.##.##...##..#.#########.#.....#..##.##.###..#..#.#";"..##.####.###.#..#...#..#.##...##..####.##.##..#..#...#..#.##.###.#.....#..#.##...####.#.###...##...";".#.####.##.###..###..###.#....#####.###.#...#..##..##..#.#...#.#.##.##.##.#...#...##.#..#..#...#.#..";"..###.##..#####.##.#.#..#..##..##.##...##.#....######.#.##.#......#..#.##...###.#.##.#.#######.##..#";"##..#.#.##..####..#...#.#....##.#.#.#..##.#..#..####.....###..##...#..##.#.#.#.##.....###....#..####";"#.#####..###.#.....##.#.#.#..#.#.#.#...#.#.##..####....#.###.###...#...#.#.##...#..#.#.#.....###..#.";".#.#.#...##..##..##.##...###...#..#.#...#.#..#####......###########.##...######....#..#.#..#.#..#...";"##.########...#..##..#..####..##...#.#.....##.###..#.##.#....##..#.#.###..###..###.##.#.####...###.#";"###...##.#...##.#..#.###..###.#..##.#.#..#..#...#.###.##...#..###.#.#....#.#.##.####..####..##.#.###";".#..#.#.##.....#.###...#.###....##.####...##.#........###..#.###.#.#.#.###..#.#.####.##.##.....#.##.";"##.#.##..###.#....#.#...#.#..####.###..#...#.#...##..###.#...##..#...#..#.####...#..##..##......#...";"#.###.####.##.#..#..........#........#########.##..####.#..##.#.#...#...#...##.##..#..######.....#.#";"#####.....##.#####..###.###.###.####........#####.###.#.######.##.#.##...####..#..##.##.####.....#.#";"..##..#.##...#.##.#.#....#...#.......##........####.##...######.#.#...######..##..#..#.#.#..###.##..";"...######..##...###.#...##...#.###.###..#.#..##....#..##..####..#..###...#.......#.#.#.#.##...###.##";"###..#.####....###.#.#..#..#..####....##.#.#..#.#.#.#...##..##.#.##..##....#..##..#.####.#.........#";"#......#.#....#.######..#.#...##...#.#.#.#...##......###...#....#..######..#.#.###..#..####.##.###.#";".######..###....#...##..###.##........###...#..#.###...#...#..#..###.#..#..##....####.#.#.#.#...##..";".....##.#.###..#.#.#..###.##.#.######.#.####.#.##..##...#..####.#.###..##.##..#..##.####.##...#.#...";"#.#...#.#..##........##########.#.#.#.#.##..#.##.##..#..#####...........#..#.###...#####.###....##.#";".##.##.###...#.##.##.#..#.#...#.##....#.##.##.##..#.#.#..##...#######.#.#...#.####.##..#.#...##..###";"##.#..#..#.#..#.#...###.#..#.#...#.####.#..#...##....###.###.#.#..###.#..###..##...#..###.####...#..";"##..##..#..#...##.##...#...#....##..###.#.#.....#.####..#......##.###.###...###...#####.###..#..###.";"....###...#......#####....#.#.#..#..#...#...####.########..##...#..######.###.#.#.....###....#.#####";".###..#.#.........####.##.##..#.#..#..####.##.##........#..###..###.#.....##..##..##.#..###.##.###.#";".#.####.###.#..#...#####.###.#....##.#.....##.##.#...###..#...#.#...##.####..##..#.#..##.#.#....###.";"##.#.###..##..#.#.####.##.##.####.##......####....#####.##.###..#.####...#.####..####.##.#......##..";"#.#.#.##.#..#..####.#.#..##..#.##..#..#####......#.#..###.#.####.##.##..####...#..###.#...#..##.#...";"###..#####....#...#...####.....#####...####.###...#.#..##.###.#.##.##.#.###..##.#.####.......#.#.#.#";".##.#...##..#.##.##.....###.##..#.###....##..####.##.#........##.#..##....###.....###...#..##.....#.";".#####..#######.##.####..#...#.##.######..#.#...#.#.##.###.##........#####......#####..#.#.##...####";".#.#.##......####...##..######...###..##..#.#..#...###..##.#.#...######.####.#.........####...#...#.";"##.#...##.#.#.#...#..##.###..###....###..#.#...##.###...#.###..#.##.##.##..##.##.#..#####.#..####..#";"##.#.#.....#.#..#.####.###.....###.#.......#..#..##..##.##.#.##..###..#.#..#.#####.####..####.#####.";".#..##..#.##..#...###..#...#..#......#.#..#.#######.#.#.####.###...#####....#.###.###.#.##...###.#.#";"###.#....##.###.###.###.##.###..#######....#####..###.#..####...#...#.##.#...#.......#.....##.#.####";"#.##.#.#########...##..###..#.####...#.####.#...##.###.#......###.###.##.####..#.#.##.##.#..###..###";".##......##.##.....#####.....#.##..##.#.#.#.##.##..###..######.###.#.###..#...##.####...##..#..####.";"....###.#####...##.####.#...#....##.#..#.###.#.###...##....#.##...###..##..........###..#.###.####.#";"..#.###.#.#.#.#..##....#####..#..####.#######.#..#####.#.#.#####..####.##.#..#.#.###..##.####......#";"#.#.##.....#..##....##.#.#.##....#....##..####.##..###....##.##.#..##.######..#...#...#.###...#...#.";"##...##.#....#.####..######...#...#.###....###....#.####.#...#...####.##.#.#.##....######.###.###..#";"#.###.#...##...##..###.#.##..#..#..##....####.#.##.#.####..##..#..#...#..##.#####.#..#.......##.##.#";"..#...##.#.....#.##.###.........#.###....##..#........#....###.##.###.###.....#..####.##....#...#..#";"#.###.#.#.#.....##.#.#...##.####.##....##.##..#...##..###.#####..###.#.#.#####.#.###...#####.....##.";".##..##..#.####.#####...###.#####..#..####..#..###.##..#....##.#...#.#..##.#.#.#....#....#...#..#..#";"#.....#..#..#.#.#...#.##.#.###.#.##..##.#.#....#####...#.#..#.#...........#..##.....###.##.###.##..#";"#.#..#..##..#..##..#..#.##.##..####....#####..###.#...##.##....#...##.##.#.#.##.##.#.##...#......###";"..#...#..#.##.#.###..####..##....#....#.##.#.##.####.#.#.###..#.##..#..####..#..#..#..##.#.##..#..#.";".....##.##....####....##..##...##..###.##...#..##..#..#....#...###..#.....#.....#######.#..###.#.##.";"#.#.#..###.#.#.##.#.#....#.#.##.###.##.#.##.#####..#.#.#..####..#...####..###.##...#.#####....#####.";"##..#....####.#.#..#....#.##.#....##.#....#.#..##..#...#..#.#..#...#.#.#..###..####..#..#.#..#...#..";".#....#.##..##.###.##..#....#...#..#.#.#..###..#......#...#####.#..#.......##..######...#.###.#.....";"#.#...#...###.#####.#..#.....#...#...####..#.#.##..##...#......#....#.###.######......#.###.#.#.####";".#####.#.#.##..##.##.#...##.#.##.#...###..#######..#..#.###....#....#.....#.#.#.#...#.#.....##.###..";"##........##...#.###.##....###...#..#...#.##..#######...####..#.#.#...###.###..####.##..#.#.####..##";"#..#.#.########..##.....##.##...#.#.#.##.###.#...###.##.###..###.#.####....###....#..##.#....##.....";"##########.##########.###.....#.....####..##.#.#.######.#.#....####.##.##...#...#..#.##.##...#.....#";".......##.####......##..#...#..#..##........####.#.#.#.#.##..##...###.##...##....#.##.####.####.....";"#####.....#..#..##.######...#.....###.####.#.#####..#####.#.##..#.#.##.#..#.#..##.#..######.#..#..##";"#....##.#.#.####..###.##.#.###.##..##....##..##..........###.#..######....#..#.##.#.####..##..##..##";"...##.####.#..#..####.#....##..##..##.....#########..###..###.#.#..##.#.##..#...##.#..#.#.#.########";"#######..#..#.###....###....##..#####.#####.####.#######.###.#..#...#..#..##.#.####....#..#.#..##.#.";".##.#.#.#.#..#.####..#..##.#..#..##..#.##..#..#.##..#...#..#.###..#.#..##..##.#.....##...#....##.#..";"##.#.#.#.#.#.####.##..#.#..#.###.###..#..###...#..##.##.####..#.....####...#....###..####.##.#..#...";"....##..###.##.###.#..####.#.##.##.##.##.#.#.####..#..##..#..#...####.#######...##..###.##.##..##.#.";"...#####..##.###.#.#...#.##...####...##..###.#.#####....##.##....###.#..#.#..##....#.#####.##.#..###";".#.#.#..#..#..##.###.###..#.#..###....##..##.#.....#..#.#....#####......#####.#.##...#..#....##..#.#";"...#.######..####..##.....#.#....#####.#...#....#.#.#.#...####.#.#.#.###.###...##..###.###.###.##...";"#..####.#####.###.#....#####.#.###.###.##.###...##.##....####.#.##..#.#.#..#....#..#..#.#...######..";".##..##..#####.#..###..#.##....##.#....##..##.#..##.#.###.....##..##.#...#..#.##.#.###.###.#......##";"####.#.#..#######.###.#..#.###.#.#.#.##..#..#...#####.##....#.##.####.#..##...#.#....#....##..#..#.#";".......#.#.#...##.#...#.#.#..###....#..##..###..#.#.#.#.##.#....#....#..#..##......###.##.#..#...##.";"#.##.###...#..#...#.#.##..####.......#.......###...######...##.#.....#..#............#.#.#....###..#";"......#.#.#..####....##.###.##...###..#.#.###.#####..####.###.#.##..#....##.##....#.#.#.#.#.##..#.##";"....#.#.......##..##..#.##...#...#.##...#.#.##.#.#...###..#####.###.#.##.....##..#..#.#.#.##...#.#.#";"#..###..#.#.#.#..#.#....#.##..##.#..#..###..#.#.....###..#####.#######.#...#.####.#..#.#..#######..#";"...#.#.##...#...###..#######..##.#.#.#.###.#.##.#.##..####..#..###..#.##.##.######.#####.####.#.#..#";".###.###.###.###..######.#.#..###..#.#.....#.#...##..##.#.###...##....#.##.##.###...#.#.#..##.#.#.##";"##..#..#..#.###.##....####....##.#..#######.#..#.###..#.####.#####...#..#.##......#...#.###..#...##.";"#.###..##.#.#....#.##..##.##.#.#.###.##..#......####.###....###..#.#.##...#.#.#.#.#..##....##...#.#.";"...#.###..#..#.##.###.#...#..#..#.##.##....#.#.#.#..###...#.###..#..#..####...#....#..####..#...##..";".......##..#...###.#.....#...###..##.###.##..#..#.#...#.###.#.#.###.#.......#####.##..##......#.##.#";".#.....#.###.#.#####..#.##.#.#.#.#.###..#.#..##.###..##.##..#....#.###....#....#..#..###..#..#.##.##";"#####.#.##.###.##...#.##.##.#.#....#.##.#.#..#.#.##...##.########..#.#....#####.#######........#..#.";"#...###..####.##.#.#####..##.###...###.##..#..##...##.....####...#.......#....#.#.###..#......#..##.";"....##...####..##.###..###......###.#..#....####...###....#.#.#..#.#....#####.....##...#.......#.#..";".....#.#.#.##..####.#...#...##.###..##.#.##.....###.##.##..#.##.##..#.#....#.##.####..##.#.####.##..";".##..###...##.#.#..#.#.#..###...#...##.##.##.#.#....###..##...###...#..#.#.##..##..#..#..#.#.##.....";"###..#......###.##..##.###...#.##.######.###..#...##.#....#..####..###...###.#.#######.#.####.#.##..";"#.#.#.#####.##...#..#.#...#......##.###..#.#...###......#..#..###..#..#.#.#####.#....##.#.###....##.";"...##...##.#....#.##.#..####...#.##.##..#.######..#..#######.#...####.####....##.##.#.....#..####.##";"#...##.#.#.....##..##.###..#.#..#.#.##.....#.#..#.#.#..#.....#.###.#.#.#.#...###..#..#.#.###..#.#.#.";"..#.#..#.##.#.##.####.#.##.#..##.##.#...#.....##.#..##.#..##..#####.#......#.##....#...##..####.###.";"#...###..#####...#...##.##......#.#......#..#.###...#....####.##.####......##..#..###...##.######.##"|]

let image data i j = 
	let n = Array.length data in
	if i < 0 || j < 0 || i >= n || j >= n then
		0
	else
		if data.(i).[j] = '#' then 1 else 0

let image1 data i j =
	let x = ref 0 in
	for a = -1 to 1 do
		for b = -1 to 1 do
			x := !x * 2;
			x := !x + (image data (i+a) (j+b));
		done;
	done;
	if algo.[!x] = '#' then 1 else 0

let image2 data i j =
	let x = ref 0 in
	for a = -1 to 1 do
		for b = -1 to 1 do
			x := !x * 2;
			x := !x + (image1 data (i+a) (j+b));
		done;
	done;
	if algo.[!x] = '#' then 1 else 0

let count data =
	let n = Array.length data in
	let c = ref 0 in
	for i = -2 to n+1 do
		for j = -2 to n+1 do
			if (image2 data i j = 1) then
				c := !c + 1;
		done;
	done;
	!c;;

Printf.printf "%d\n" (count data)


let calc alg dat n =
	let images = Array.make (n+1) dat in
    let genImage alg data i = 
    	let n = Array.length data in
    	let img = Array.make (n+2*i) (String.make (n+2*i) ' ') in
    	let getFromPrev a b =
    		let p = a-1 in let q = b-1 in
    		if p < 0 || q < 0 || p >= (n+2*i-2) || q >= (n+2*i-2) then
    			if i mod 2 = 0 && alg.[0] = '#' then 1 else 0
    		else
    			if images.(i-1).(p).[q] = '#' then 1 else 0
    	in
    	for k = 0 to n+2*i-1 do
    		let str = ref [] in
    		for j = 0 to n+2*i-1 do
    			let x = ref 0 in
    			for a = -1 to 1 do
    				for b = -1 to 1 do
    					x := !x * 2;
    					x := !x + (getFromPrev (k+a) (j+b));
    				done;
    			done;
    			str := (alg.[!x]) :: !str			
    		done;
    		img.(k) <- (String.init (n+2*i) (List.nth (List.rev !str)));
    	done;
    	images.(i) <- img;
    	let c = ref 0 in
    	for p = 0 to n+2*i-1 do
    		for q = 0 to n+2*i-1 do
    			if (img.(p).[q] = '#') then
    				c := !c + 1;
    		done;
    	done;
    	!c
    in
    let x = ref 0 in
    for i = 1 to n do
        x := genImage alg dat i
    done;
    !x;;

Printf.printf "%d\n" (calc algo data 50)
